!function(e){var t,i,a={init:function(){e(".fes-form").on("click","img.fes-clone-field",this.cloneField),e(".fes-form").on("click","img.fes-remove-field",this.removeField),e(".fes-ajax-form").on("submit",this.formSubmit),e(".fes-fields").on("click","a.fes-feat-image-btn",this.featuredImage.addImage),e(".fes-fields").on("click","a.fes-remove-feat-image",this.featuredImage.removeImage),e(".fes-fields").on("click","a.fes-avatar-image-btn",this.avatarImage.addImage),e(".fes-fields").on("click","a.fes-remove-avatar-image",this.avatarImage.removeImage),e(".fes-fields").on("click","a.upload_file_button",this.fileDownloadable),e(".fes-fields").on("click","a.insert-file-row",function(t){t.preventDefault();var i=e(this).attr("id"),a=e("#fes-upload-max-files-"+i).val(),r=e(".fes-variations-list-"+i),s=r.find(".fes-single-variation:last"),n=s.clone();delete n[1],n.length=1;var o=r.find(".fes-single-variation").length;return o+1>a&&0!=a?alert(fes_form.too_many_files_pt_1+a+fes_form.too_many_files_pt_2):(n.find("input, select, textarea").val(""),n.find("input, select, textarea").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(o)+"]"),e(this).attr("name",t).attr("id",t),n.insertBefore("#"+i)}),!1)}),e(".fes-fields").on("click","a.edd-fes-delete",function(t){t.preventDefault();var i=e(this).parents(".fes-single-variation"),a=e(this).parents("[class^=fes-variations-list-]"),r=a.find(".fes-single-variation").length;return 1==r?(i.find("input, select, textarea").val(""),!1):(i.remove(),!1)})},avatarImage:{addImage:function(t){t.preventDefault();var a=e(this);return i?void i.open():(i=wp.media({title:fes_form.avatar_title,button:{text:fes_form.avatar_button},library:{type:"image"}}),i.on("select",function(){var e=i.state().get("selection");e.map(function(e){e=e.toJSON(),a.siblings("input.fes-avatar-image-id").val(e.id);var t=a.closest(".instruction-inside"),i=t.siblings(".image-wrap");i.find("img").attr("src",e.url),t.addClass("fes-hide"),i.removeClass("fes-hide")})}),void i.open())},removeImage:function(t){t.preventDefault();var i=e(this),a=i.closest(".image-wrap"),r=a.siblings(".instruction-inside");r.find("input.fes-avatar-image-id").val("0"),a.addClass("fes-hide"),r.removeClass("fes-hide")}},fileDownloadable:function(t){t.preventDefault();var i,a=e(this);return i?void i.open():(i=wp.media({title:fes_form.file_title,button:{text:fes_form.file_button},multiple:!1}),i.on("open",function(){e.post(fes_form.ajaxurl,{action:"fes_turn_on_file_filter"},function(e){})}),i.on("close",function(){e.post(fes_form.ajaxurl,{action:"fes_turn_off_file_filter"},function(e){})}),i.on("select",function(){var e=i.state().get("selection");e.map(function(e){e=e.toJSON(),a.closest("tr").find("input.fes-file-value").val(e.url)})}),void i.open())},featuredImage:{addImage:function(i){i.preventDefault();var a=e(this);return t?void t.open():(t=wp.media({title:fes_form.feat_title,button:{text:fes_form.feat_button},library:{type:"image"}}),t.on("select",function(){var e=t.state().get("selection");e.map(function(e){e=e.toJSON(),a.siblings("input.fes-feat-image-id").val(e.id);var t=a.closest(".instruction-inside"),i=t.siblings(".image-wrap");i.find("img").attr("src",e.url),t.addClass("fes-hide"),i.removeClass("fes-hide")})}),void t.open())},removeImage:function(t){t.preventDefault();var i=e(this),a=i.closest(".image-wrap"),r=a.siblings(".instruction-inside");r.find("input.fes-feat-image-id").val("0"),a.addClass("fes-hide"),r.removeClass("fes-hide")}},cloneField:function(t){t.preventDefault();var i=e(this).closest("tr"),a=i.clone(),r=i.parent().find("tr"),s=highest=0;r.each(function(){var t=e(this).data("key");parseInt(t)>highest&&(highest=t)}),s=highest+1,a.attr("data-key",parseInt(s)),a.find(":checked").attr("checked",""),a.find("input, select, textarea").val(""),a.find("input, select, textarea").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(s)+"]"),e(this).attr("name",t).attr("id",t)}),i.after(a)},removeField:function(){var t=e(this).closest("tr"),i=t.siblings().andSelf().length;i>1&&t.remove()},formSubmit:function(t){t.preventDefault();var i=e(this),r=i.find("input[type=submit]"),s=a.validateForm(i);if(s){var n={lines:13,length:11,width:5,radius:17,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"fes_spinner",zIndex:2e9,top:"auto",left:"auto"};""!==fes_form.loading_icon&&(n.icon=fes_form.loading_icon);var o=document.createElement("div");if(document.body.appendChild(o),""!=fes_form.loading_icon)var f=fesSpinner({text:fes_form.loadingtext,icon:fes_form.loading_icon});else var l=new Spinner(n).spin(o),f=fesSpinner({text:fes_form.loadingtext,spinner:l});r.attr("disabled","disabled").addClass("button-primary-disabled"),e.post(fes_form.ajaxurl,s,function(e){if(e.success){var t="",s="";t=e.title?e.title:fes_form.successtitle,s=e.message?e.message:fes_form.successmessage,e.skipswal?(f.hide(),"#"!==e.redirect_to&&(window.location=e.redirect_to)):(f.hide(),swal({title:t,text:s,html:!0,allowEscapeKey:!1,type:"success"},function(){"#"!==e.redirect_to?window.location.href=e.redirect_to:(r.removeClass("button-primary-disabled"),i.find("span.fes-loading").remove(),r.removeAttr("disabled"))}))}else{var n=e.errors;if("undefined"!=typeof n&&a.hasItems(n)>0)for(var o in n)a.markError(i,o,n[o]);var t="",s="";t=e.title?e.title:fes_form.errortitle,s=e.message?e.message:fes_form.errormessage,f.hide(),swal({title:t,text:s,html:!0,type:"error"}),r.removeAttr("disabled")}r.removeClass("button-primary-disabled"),i.find("span.fes-loading").remove()}).fail(function(t,a,s){var n="",o="";n=fes_form.ajaxerrortitle,o=e(t.responseText).text(),console.log(o),o=o.substring(0,o.indexOf("Call Stack")),f.hide(),swal({title:n,text:o,html:!0,type:"error"}),r.removeAttr("disabled"),r.removeClass("button-primary-disabled"),i.find("span.fes-loading").remove()})}},hasItems:function(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},validateForm:function(t){a.removeErrors(t);var i,r=t.serialize(),s=[];return e(".fes-rich-validation").each(function(t,a){i=e(a).data("id"),val=e.trim(tinyMCE.get(i).getContent()),s.push(i+"="+encodeURIComponent(val))}),r=r+"&"+s.join("&")},markError:function(e,t,i){var a=e.find(".fes-el."+t);a.append('<div class="edd_errors edd-alert edd-alert-error fes-form-field-error" style="margin-bottom: 0px"><p class="edd_error">'+i+"</p></div>")},removeErrors:function(t){e(t).find(".fes-form-field-error").remove()}};e(function(){a.init()})}(jQuery);